name: "Summarize Report"
description: "Summarize a security scan report and write to GITHUB_STEP_SUMMARY"


inputs:
  tool:
    description: "Tool name (e.g., Trivy, Grype)"
    required: true
  report:
    description: "Path to the report file"
    required: true
  critical_keyword:
    description: "Keyword used to count critical vulnerabilities"
    required: true
  high_keyword:
    description: "Keyword used to count high vulnerabilities"
    required: true

runs:
  using: "composite"
  steps:
    - shell: bash
      run: |
        REPORT="${{ inputs.report }}"
        TOOL="${{ inputs.tool }}"
        CRIT_KEY="${{ inputs.critical_keyword }}"
        HIGH_KEY="${{ inputs.high_keyword }}"

        CRITICAL=$(grep -c "$CRIT_KEY" "$REPORT" || true)
        HIGH=$(grep -c "$HIGH_KEY" "$REPORT" || true)

        echo "## 🛡️ $TOOL Scan" >> $GITHUB_STEP_SUMMARY
        echo "- 🚨 Critical: $CRITICAL" >> $GITHUB_STEP_SUMMARY
        echo "- ⚠️ High: $HIGH" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "<details><summary>📄 View Raw Report (truncated)</summary>" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        head -n 100 "$REPORT" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        echo "</details>" >> $GITHUB_STEP_SUMMARY
